<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sumkurve med Fraktiler</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  canvas { border: 1px solid #ccc; margin-bottom: 40px; }
  #fraktiler { margin-top: 20px; }
</style>
</head>
<body>

<h1>Sumkurve: Hyppighed og Frekvens</h1>

<canvas id="sumkurveHyppighedCanvas" width="800" height="600"></canvas>
<canvas id="sumkurveFrekvensCanvas" width="800" height="600"></canvas>

<div id="fraktiler">
  <h2>Beregn fraktiler (værdier mellem 0 og 1)</h2>
  <input id="fraktilInput1" type="number" step="0.01" min="0" max="1" placeholder="Fraktil 1 (fx 0.25)" />
  <input id="fraktilInput2" type="number" step="0.01" min="0" max="1" placeholder="Fraktil 2 (fx 0.5)" />
  <input id="fraktilInput3" type="number" step="0.01" min="0" max="1" placeholder="Fraktil 3 (fx 0.75)" />
  <button onclick="beregnFraktiler()">Beregn fraktiler</button>
  <div id="fraktilResultat"></div>
</div>

<script>
let sumChartHyppighed = null;
let sumChartFrekvens = null;

const globalData = {
  // Eksempeldata - justér eller hent dynamisk efter behov
  intervals: [
    [0, 10],
    [10, 20],
    [20, 30],
    [30, 40],
    [40, 50]
  ],
  frequencies: [5, 10, 20, 10, 5],
  N: 50,
  cumFreq: []
};

function beregnKumulativHyppighed() {
  let cumFreq = [];
  let total = 0;
  for (let f of globalData.frequencies) {
    total += f;
    cumFreq.push(total);
  }
  globalData.cumFreq = cumFreq;
  globalData.N = total;
}

// Beregn kumulativ frekvens ved start
beregnKumulativHyppighed();

function showSumkurveHyppighed() {
  const { intervals, cumFreq } = globalData;
  if (!intervals || !cumFreq) return;

  const points = [{ x: intervals[0][0], y: 0 }];
  for (let i = 0; i < intervals.length; i++) {
    points.push({ x: intervals[i][1], y: cumFreq[i] });
  }

  const ctx = document.getElementById("sumkurveHyppighedCanvas").getContext("2d");
  if (sumChartHyppighed) sumChartHyppighed.destroy();

  sumChartHyppighed = new Chart(ctx, {
    type: "line",
    data: {
      datasets: [{
        label: "Kumulativ hyppighed",
        data: points,
        borderColor: "orange",
        backgroundColor: "transparent",
        tension: 0,
        fill: false,
        pointRadius: 3,
        pointHoverRadius: 5,
        showLine: true,
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: {
          type: "linear",
          title: { display: true, text: "Intervalgrænse" },
          min: intervals[0][0],
          max: intervals[intervals.length - 1][1],
          ticks: { stepSize: 5 }
        },
        y: {
          beginAtZero: true,
          title: { display: true, text: "Kumulativ hyppighed" },
        }
      },
      plugins: { legend: { display: false } },
      animation: false,
    }
  });
}

function showSumkurveFrekvens() {
  const { intervals, cumFreq, N } = globalData;
  if (!intervals || !cumFreq || !N) return;

  const points = [{ x: intervals[0][0], y: 0 }];
  for (let i = 0; i < intervals.length; i++) {
    points.push({ x: intervals[i][1], y: cumFreq[i] / N });
  }

  const ctx = document.getElementById("sumkurveFrekvensCanvas").getContext("2d");
  if (sumChartFrekvens) sumChartFrekvens.destroy();

  sumChartFrekvens = new Chart(ctx, {
    type: "line",
    data: {
      datasets: [{
        label: "Kumulativ frekvens",
        data: points,
        borderColor: "green",
        backgroundColor: "transparent",
        tension: 0,
        fill: false,
        pointRadius: 3,
        pointHoverRadius: 5,
        showLine: true,
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: {
          type: "linear",
          title: { display: true, text: "Intervalgrænse" },
          min: intervals[0][0],
          max: intervals[intervals.length - 1][1],
          ticks: { stepSize: 5 }
        },
        y: {
          beginAtZero: true,
          max: 1,
          title: { display: true, text: "Kumulativ frekvens" },
        }
      },
      plugins: { legend: { display: false } },
      animation: false,
    }
  });
}

function beregnFraktiler() {
  const p1 = parseFloat(document.getElementById("fraktilInput1").value);
  const p2 = parseFloat(document.getElementById("fraktilInput2").value);
  const p3 = parseFloat(document.getElementById("fraktilInput3").value);
  const pValues = [p1, p2, p3].filter(p => !isNaN(p) && p >= 0 && p <= 1);

  if (!sumChartFrekvens) {
    alert("Sumkurve for frekvens findes ikke - beregn først data.");
    return;
  }

  // Behold kun den oprindelige sumkurve-dataset, fjern tidligere fraktil linjer
  sumChartFrekvens.data.datasets = sumChartFrekvens.data.datasets.slice(0, 1);

  const { intervals, cumFreq, N, frequencies } = globalData;
  if (!intervals || !cumFreq || !N) return;

  let outputHtml = "<h3>Fraktiler (ud fra kumulativ frekvens)</h3><ul>";

  pValues.forEach((p) => {
    // Find interval hvor p falder i den kumulative frekvens
    let i = cumFreq.findIndex(cf => (cf / N) >= p);
    if (i === -1) i = cumFreq.length - 1;

    const L = intervals[i][0];                  // intervallets nedre grænse
    const w = intervals[i][1] - intervals[i][0]; // intervalbredde
    const F = i === 0 ? 0 : cumFreq[i - 1];    // kumulativ frekvens før intervallet
    const f = frequencies[i];                   // hyppighed i intervallet

    // Beregn fraktil med lineær interpolation
    const x_p = L + ((p * N - F) / f) * w;

    outputHtml += `<li>p = ${p.toFixed(2)} → xₚ = ${x_p.toFixed(2)}</li>`;

    // Lodret streg for fraktil (fra y=0 til y=p)
    sumChartFrekvens.data.datasets.push({
      label: `Fraktil p=${p.toFixed(2)}`,
      data: [
        { x: x_p, y: 0 },
        { x: x_p, y: p }
      ],
      borderColor: "blue",
      borderDash: [6, 6],
      fill: false,
      pointRadius: 0,
      tension: 0,
      showLine: true,
    });

    // Vandret streg for fraktil (fra x=interval start til x=x_p ved y=p)
    sumChartFrekvens.data.datasets.push({
      label: `Fraktil vandret p=${p.toFixed(2)}`,
      data: [
        { x: L, y: p },
        { x: x_p, y: p }
      ],
      borderColor: "blue",
      borderDash: [6, 6],
      fill: false,
      pointRadius: 0,
      tension: 0,
      showLine: true,
    });
  });

  sumChartFrekvens.update();

  document.getElementById("fraktilResultat").innerHTML = outputHtml + "</ul>";
}

// Vis sumkurver ved start
showSumkurveHyppighed();
showSumkurveFrekvens();

</script>

</body>
</html>
